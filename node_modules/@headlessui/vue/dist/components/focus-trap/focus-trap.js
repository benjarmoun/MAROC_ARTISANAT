import{computed as f,defineComponent as k,h as E,onMounted as M,ref as v,watch as p,Fragment as g}from"vue";import{render as B}from"../../utils/render.js";import{Hidden as b,Features as D}from"../../internal/hidden.js";import{dom as F}from"../../utils/dom.js";import{focusIn as L,Focus as d,focusElement as m,FocusResult as P}from"../../utils/focus-management.js";import{match as I}from"../../utils/match.js";import{useTabDirection as O,Direction as w}from"../../hooks/use-tab-direction.js";import{getOwnerDocument as S}from"../../utils/owner.js";import{useEventListener as j}from"../../hooks/use-event-listener.js";import"../../utils/micro-task.js";var y=(e=>(e[e.None=1]="None",e[e.InitialFocus=2]="InitialFocus",e[e.TabLock=4]="TabLock",e[e.FocusLock=8]="FocusLock",e[e.RestoreFocus=16]="RestoreFocus",e[e.All=30]="All",e))(y||{});let V=Object.assign(k({name:"FocusTrap",props:{as:{type:[Object,String],default:"div"},initialFocus:{type:Object,default:null},features:{type:Number,default:30},containers:{type:Object,default:v(new Set)}},inheritAttrs:!1,setup(o,{attrs:u,slots:n,expose:r}){let t=v(null);r({el:t,$el:t});let a=f(()=>S(t));A({ownerDocument:a},f(()=>Boolean(o.features&16)));let e=N({ownerDocument:a,container:t,initialFocus:f(()=>o.initialFocus)},f(()=>Boolean(o.features&2)));C({ownerDocument:a,container:t,containers:o.containers,previousActiveElement:e},f(()=>Boolean(o.features&8)));let s=O();function i(){let l=F(t);!l||I(s.value,{[w.Forwards]:()=>L(l,d.First),[w.Backwards]:()=>L(l,d.Last)})}return()=>{let l={},T={"data-hi":"container",ref:t},{features:c,initialFocus:H,containers:R,...h}=o;return E(g,[Boolean(c&4)&&E(b,{as:"button",type:"button",onFocus:i,features:D.Focusable}),B({props:{...u,...h,...T},slot:l,attrs:u,slots:n,name:"FocusTrap"}),Boolean(c&4)&&E(b,{as:"button",type:"button",onFocus:i,features:D.Focusable})])}}}),{features:y});function A({ownerDocument:o},u){let n=v(null),r={value:!1};M(()=>{p(u,(t,a)=>{var e;t!==a&&(!u.value||(r.value=!0,n.value||(n.value=(e=o.value)==null?void 0:e.activeElement)))},{immediate:!0}),p(u,(t,a,e)=>{t!==a&&(!u.value||e(()=>{r.value!==!1&&(r.value=!1,m(n.value),n.value=null)}))},{immediate:!0})})}function N({ownerDocument:o,container:u,initialFocus:n},r){let t=v(null);return M(()=>{p([u,n,r],(a,e)=>{var T,c;if(a.every((H,R)=>(e==null?void 0:e[R])===H)||!r.value)return;let s=F(u);if(!s)return;let i=F(n),l=(T=o.value)==null?void 0:T.activeElement;if(i){if(i===l){t.value=l;return}}else if(s.contains(l)){t.value=l;return}i?m(i):L(s,d.First)===P.Error&&console.warn("There are no focusable elements inside the <FocusTrap />"),t.value=(c=o.value)==null?void 0:c.activeElement},{immediate:!0,flush:"post"})}),t}function C({ownerDocument:o,container:u,containers:n,previousActiveElement:r},t){var a;j((a=o.value)==null?void 0:a.defaultView,"focus",e=>{if(!t.value)return;let s=new Set(n==null?void 0:n.value);s.add(u);let i=r.value;if(!i)return;let l=e.target;l&&l instanceof HTMLElement?_(s,l)?(r.value=l,m(l)):(e.preventDefault(),e.stopPropagation(),m(i)):m(r.value)},!0)}function _(o,u){var n;for(let r of o)if((n=r.value)!=null&&n.contains(u))return!0;return!1}export{V as FocusTrap};
